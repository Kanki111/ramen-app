
<h1 class="map_title">マップページ</h1>
<div class="map_text">
  このページは投稿されたラーメン屋さんがピン留めされていて情報を見ることができます。
</div>
<div id="map_canvas"></div>

<script>
var map;
var marker = [];
var infoWindow = [];
<% @member_posts.each do |member_post| %>
var markerData = [ {
    title: '<%= member_post.title %>',
    lat: <%= @member_post.latitude %>,
    lng: <%= @member_post.longitude %>,
    content: "<%= @member_post.title %><br><img src='<%= @member_post.image.to_s%>' class='pop_image'><br><div class='test'><a href='https://ramen-app-main.herokuapp.com/member/posts/27' target='_blank'>投稿ページへ</a></div>"
},];	
  <% end %>

  function initMap() {
    // 緯度経度のデータ作成
    var mapLatLng = new google.maps.LatLng({lat: 35.732981, lng: 139.727423});
    // 地図の基本設定
    map = new google.maps.Map(document.getElementById('map_canvas'), {
      center: mapLatLng, // 地図の中心座標を指定
      zoom: 11,
      mapTypeId: google.maps.MapTypeId.ROADMAP // マップの表示種別選択 (ROADMAP・SATELLITE・TERRAIN・HYBRIDから選択)
    });
    
    // マーカー毎の処理
    for (var i = 0; i < markerData.length; i++) {
      // 緯度経度のデータを作成
      markerLatLng = new google.maps.LatLng({lat: markerData[i]['lat'], lng: markerData[i]['lng']});
      marker[i] = new google.maps.Marker({
        position: markerLatLng, // マーカーを立てる位置を指定
        map: map, // マーカーを立てる地図を指定
        title: markerData[i]['title'] // ツールヒント
      });
      
      // 吹き出しの設定
      infoWindow[i] = new google.maps.InfoWindow({
        // 吹き出しに表示する内容を設定する
        content: markerData[i]['content']
      });
      
      // マーカーにクリックイベントを追加
      markerEvent(i);
    }
  }
   
  // マーカーにクリックイベントを追加
  function markerEvent(i) {
      marker[i].addListener('click', function() {
        // 吹き出しの表示
        infoWindow[i].open(map, marker[i]);
    });
  }
</script>
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBfCmlyL2lyPkB-fTxtmVP_q0VEpEtGXW4&language=ja&region=JP&callback=initMap" async defer></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<%= render "common/footer" %>
